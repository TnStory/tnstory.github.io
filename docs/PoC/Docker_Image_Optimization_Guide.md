# 도커 이미지 최적화 가이드

이 문서는 도커 이미지 최적화의 다양한 방법을 정리한 가이드입니다.   
Java 애플리케이션을 위한 Gradle Jib, GraalVM의 장단점과 서드파티 애플리케이션 배포 시 고려사항도 함께 다룹니다.

<span style="color:#1976d2; font-weight:bold; font-size:1.1em;">
결론 : Java는 Gradle Jib 사용하는 것이 최적화 잘 되고, 간단. <br>
BuildPack(CNCF 산하의 공식 표준)도 고려해 보자.
</span><br>

---

## 1. 왜 최적화해야 할까?

- **더 빠른 배포:**  
  이미지 크기가 작아지면 네트워크 전송 시간이 줄어 전체 배포 속도가 빨라진다.

- **보안 강화:**  
  불필요한 패키지와 파일을 제거하면 공격 표면이 줄어든다.

- **리소스 효율성:**  
  이미지를 최적화하면 저장 공간과 컨테이너 실행 시 메모리 사용량이 줄어든다.

---

## 2. 최적화 방법

- **최소한의 베이스 이미지 사용:**  
  Alpine이나 distroless와 같은 경량 베이스 이미지를 사용.

- **멀티스테이지 빌드:**  
  빌드 도구와 런타임 환경을 분리해 최종 이미지에 필요한 파일만 포함.

- **캐시 최적화 및 명령어 통합:**  
  `RUN` 명령을 합쳐 레이어 수를 줄이고 빌드 캐시를 효율적으로 활용.

- **불필요한 파일 제거:**  
  빌드 후 임시 파일과 캐시 데이터를 삭제.

- **.dockerignore 사용:**  
  빌드 컨텍스트에서 불필요한 파일을 제외해 빌드 속도를 높인다.

- **Docker Slim 활용:**  
  Docker Slim은 기존 이미지를 분석해 불필요한 파일과 설정을 제거, 이미지 크기를 크게 줄여준다.  
  [자세히 보기](https://github.com/slimtoolkit/slim)

---

## 3. Java 애플리케이션 최적화

### Gradle Jib

- **장점:**
  - Dockerfile 없이 Gradle 빌드에서 바로 컨테이너 이미지를 생성할 수 있다.
  - 빌드 캐시를 활용해 이미지 생성 시간을 단축하고, 이미지 레이어를 자동으로 최적화한다.

- **단점:**
  - 커스터마이징이 많이 필요할 경우 한계가 있을 수 있다.
  - Dockerfile에 비해 추상화 수준이 높아 세밀한 제어가 어렵다.

[Gradle Jib 플러그인 GitHub](https://github.com/GoogleContainerTools/jib/tree/master/jib-gradle-plugin)

### GraalVM

- **장점:**
  - 네이티브 이미지를 생성하면 애플리케이션 시작 속도가 빨라지고 메모리 사용량이 줄어든다.
  - 빠른 부팅과 낮은 런타임 오버헤드를 제공한다.

- **단점:**
  - 네이티브 이미지 생성 과정이 오래 걸리고 빌드가 복잡해질 수 있다.
  - 동적 기능이나 리플렉션 사용에 제약이 있어 코드 수정이나 추가 설정이 필요할 수 있다.

[GraalVM 공식 사이트](https://www.graalvm.org/)

---

## 4. 서드파티 애플리케이션 배포 시 고려사항

- 서드파티에서 제공하는 배포 방식과 이미지를 그대로 활용하는 것이 좋다(이미 최적화됨).
- 직접 최적화를 시도하면 복잡성만 높아지고 실질적인 이득은 적을 수 있다.
- 실무 경험상, 서드파티 이미지는 그대로 사용하거나 최소한의 수정만 하는 것이 효율적이다.
